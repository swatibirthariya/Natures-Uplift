{% extends "base.html" %}
{% block title %}Your Cart{% endblock %}

{% block content %}
<div class="cart-container">

  <h2 class="cart-title">Your Cart</h2>

  {% if items %}
    <div class="cart-list">
      {% for item in items %}
        <div class="cart-item">

          <div class="item-info">
            <h4>{{ item.product.name }}</h4>
            <p class="item-price">
              ‚Çπ{{ item.product.price|floatformat:2 }} each
            </p>
          </div>

          <div class="item-actions">
            <div class="qty-box">

              {% if user.is_authenticated %}
                <!-- Logged-in user quantity controls -->
                <a href="{% url 'decrease_qty' item.id %}" class="qty-btn">‚àí</a>
                <input type="text" value="{{ item.quantity }}" readonly>
                <a href="{% url 'increase_qty' item.id %}" class="qty-btn">+</a>
              {% else %}
                <!-- Guest user (session cart) -->
                <input type="text" value="{{ item.quantity }}" readonly>
              {% endif %}

            </div>

            <div class="item-total">
              {% if item.subtotal %}
                ‚Çπ{{ item.subtotal|floatformat:2 }}
              {% else %}
                ‚Çπ{{ item.get_total_price|floatformat:2 }}
              {% endif %}
            </div>
          </div>

        </div>
      {% endfor %}
    </div>

    <div class="cart-summary">
      <div class="total-row">
        <span>Total</span>
        <strong>‚Çπ{{ total|floatformat:2 }}</strong>
      </div>

      {% if user.is_authenticated %}
        <a href="{% url 'checkout' %}" class="checkout-btn">
          Proceed to Checkout
        </a>
      {% else %}
        <p class="login-note">
          üîê Please login to proceed with checkout
        </p>
        <a href="{% url 'login' %}?next=/cart/" class="checkout-btn disabled">
          Login to Checkout
        </a>
      {% endif %}
    </div>

  {% else %}
    <p class="empty-cart">
      Your cart is empty.
      <a href="{% url 'plant_list' %}">Shop now</a>
    </p>
  {% endif %}

</div>
{% endblock %}
