{% extends "base.html" %}
{% block title %}Checkout{% endblock %}
{% block content %}

<h2 class="page-title">Checkout</h2>

<div class="checkout-container">

  <!-- LEFT: FORM -->
  <div class="checkout-form">
    <h3>Delivery Details</h3>

    <form method="post">
      {% csrf_token %}

      <label>Full Name</label>
      {{ form.full_name }}

      <label>Email</label>
      {{ form.email }}

      <label>Phone</label>
      {{ form.phone }}

      <label>Address</label>
      {{ form.address }}

      <label>City</label>
      {{ form.city }}

      <label>Pincode</label>
      {{ form.pincode }}

      <h3>Delivery Options</h3>

      <div class="delivery-options">
        <label class="delivery-option">
          <input type="radio" name="delivery_type" value="fast"
                 checked onclick="updateTotal(85)">
          <span>Fast Delivery (Same / Next Day)</span>
          <strong>₹85</strong>
        </label>

        <label class="delivery-option">
          <input type="radio" name="delivery_type" value="standard"
                 onclick="updateTotal(60)">
          <span>Standard Delivery (1–2 Days)</span>
          <strong>₹60</strong>
        </label>
      </div>

      <button type="submit" class="btn-pay">
      Proceed to Payment
    </button>
    </form>
  </div>

  <!-- RIGHT: ORDER SUMMARY -->
  <div class="order-summary">
    <h3>Your Cart</h3>

    {% for item in items %}
      <div class="cart-row">
      <div>
        <span>{{ item.product.name }}</span>
        <small>
          ₹{{ item.product.price }} × {{ item.quantity }}
        </small>
      </div>
      <span>₹{{ item.get_total_price|floatformat:2 }}</span>
    </div>
    {% endfor %}

    <hr>

  <div class="summary-row">
  <span>Subtotal</span>
  <span>₹<span id="subtotal">{{ subtotal }}</span></pan>
  <input type="hidden" id="effective-subtotal" value="{{ effective_subtotal }}">
  </div>
    <!-- offer section removable -->
      {% include "cart/_offers_summary.html" %}
     <!-- offer section removable -->
      <div class="summary-row">
        <span>Delivery</span>
        <span>₹<span id="delivery">{{ delivery_charge }}</span></span>
      </div>

      <div class="summary-row total">
        <span>Total</span>
        <span>₹<span id="grand-total">{{ grand_total }}</span></span>
      </div>

     </div>

</div>

<script>
function updateTotal(delivery) {
  const effectiveSubtotalInput = document.getElementById("effective-subtotal");
  const base = effectiveSubtotalInput
    ? parseFloat(effectiveSubtotalInput.value)
    : parseFloat(document.getElementById("subtotal").innerText);

  document.getElementById("delivery").innerText = delivery;
  document.getElementById("grand-total").innerText = (base + delivery).toFixed(2);
}
</script>
{% endblock %}


